#!/bin/bash
# Santa Package Manager Installation Script
# Generated: {{ timestamp }}
# Version: {{ version }}
# Source: {{ source_name }}
# Packages: {{ package_count }}

set -euo pipefail

echo "ğŸ… Santa Package Installation - {{ source_name }}"
echo "Generated: {{ timestamp }}"
echo "Packages to install: {{ package_count }}"
echo ""

{% if manager == "brew" %}
# Homebrew package installation
if command -v brew &> /dev/null; then
    echo "ğŸ“¦ Installing Homebrew packages..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    brew install {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… Homebrew installation completed"
else
    echo "âš ï¸  Homebrew not found. Please install Homebrew first:"
    echo "   /bin/bash -c \"\$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\""
    echo "   Then run this script again."
    exit 1
fi

{% elif manager == "apt" or manager == "apt-get" %}
# APT package installation (Debian/Ubuntu)
if command -v apt &> /dev/null; then
    echo "ğŸ“¦ Installing APT packages..."
    echo "Updating package lists..."
    sudo apt update
    
    {% for package in packages %}
    echo "Installing {{ package }}..."
    sudo apt install -y {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… APT installation completed"
else
    echo "âš ï¸  APT not found. This script is for Debian/Ubuntu systems."
    exit 1
fi

{% elif manager == "yum" %}
# YUM package installation (RedHat/CentOS)
if command -v yum &> /dev/null; then
    echo "ğŸ“¦ Installing YUM packages..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    sudo yum install -y {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… YUM installation completed"
else
    echo "âš ï¸  YUM not found. This script is for RedHat/CentOS systems."
    exit 1
fi

{% elif manager == "pacman" %}
# Pacman package installation (Arch Linux)
if command -v pacman &> /dev/null; then
    echo "ğŸ“¦ Installing Pacman packages..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    sudo pacman -S --noconfirm {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… Pacman installation completed"
else
    echo "âš ï¸  Pacman not found. This script is for Arch Linux systems."
    exit 1
fi

{% elif manager == "npm" %}
# NPM package installation
if command -v npm &> /dev/null; then
    echo "ğŸ“¦ Installing NPM packages globally..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    npm install -g {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… NPM installation completed"
else
    echo "âš ï¸  NPM not found. Please install Node.js and NPM first."
    exit 1
fi

{% elif manager == "pip" or manager == "pip3" %}
# Python pip package installation
if command -v {{ manager }} &> /dev/null; then
    echo "ğŸ“¦ Installing Python packages with {{ manager }}..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    {{ manager }} install {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… Python package installation completed"
else
    echo "âš ï¸  {{ manager }} not found. Please install Python and pip first."
    exit 1
fi

{% elif manager == "cargo" %}
# Rust cargo package installation
if command -v cargo &> /dev/null; then
    echo "ğŸ“¦ Installing Rust packages with cargo..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    cargo install {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… Cargo installation completed"
else
    echo "âš ï¸  Cargo not found. Please install Rust toolchain first:"
    echo "   curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh"
    exit 1
fi

{% elif manager == "go" %}
# Go package installation
if command -v go &> /dev/null; then
    echo "ğŸ“¦ Installing Go packages..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    go install {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… Go installation completed"
else
    echo "âš ï¸  Go not found. Please install Go first."
    exit 1
fi

{% else %}
# Generic package manager
if command -v {{ manager }} &> /dev/null; then
    echo "ğŸ“¦ Installing packages with {{ manager }}..."
    {% for package in packages %}
    echo "Installing {{ package }}..."
    {{ manager }} install {{ package | shell_escape }}
    {% endfor %}
    echo "âœ… Installation completed"
else
    echo "âš ï¸  {{ manager }} not found. Please install {{ manager }} first."
    exit 1
fi
{% endif %}

echo ""
echo "ğŸ‰ All {{ package_count }} packages have been processed!"
echo "Generated by Santa v{{ version }} - https://github.com/tylerbutler/santa"