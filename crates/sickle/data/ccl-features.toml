# CCL Feature Registry
# This file documents all supported features, functions, and behaviors in sickle

[metadata]
version = "0.1.0"
ccl_spec_version = "1.0"
last_updated = "2025-01-17"

# ============================================================================
# Core Model API - Navigation and Access
# ============================================================================

[[model.methods]]
name = "get"
signature = "get(&self, key: &str) -> Result<&Model>"
description = "Get a value by key from a map"
since = "0.1.0"
enabled = true
example = '''
let model = parse("name = Santa")?;
let name = model.get("name")?;
'''

[[model.methods]]
name = "at"
signature = "at(&self, path: &str) -> Result<&Model>"
description = "Get nested value using dot-separated path (e.g., 'database.host')"
since = "0.1.0"
enabled = true
example = '''
let model = parse("database = host = localhost")?;
let host = model.at("database.host")?;
'''

[[model.methods]]
name = "as_str"
signature = "as_str(&self) -> Result<&str>"
description = "Convert singleton to string reference"
since = "0.1.0"
enabled = true
example = '''
let model = parse("name = Santa")?;
let name = model.get("name")?.as_str()?;
assert_eq!(name, "Santa");
'''

[[model.methods]]
name = "as_list"
signature = "as_list(&self) -> Result<&[Model]>"
description = "Convert to list slice"
since = "0.1.0"
enabled = true
example = '''
let ccl = "items =\n  = one\n  = two";
let model = parse(ccl)?;
let items = model.get("items")?.as_list()?;
'''

[[model.methods]]
name = "as_map"
signature = "as_map(&self) -> Result<&BTreeMap<String, Model>>"
description = "Convert to map reference"
since = "0.1.0"
enabled = true
example = '''
let model = parse("name = Santa\nversion = 1.0")?;
let map = model.as_map()?;
assert_eq!(map.len(), 2);
'''

[[model.methods]]
name = "parse_value"
signature = "parse_value<T: FromStr>(&self) -> Result<T>"
description = "Parse singleton value to any type implementing FromStr"
since = "0.1.0"
enabled = true
example = '''
let model = parse("port = 5432")?;
let port: u16 = model.get("port")?.parse_value()?;
assert_eq!(port, 5432);
'''

[[model.methods]]
name = "is_singleton"
signature = "is_singleton(&self) -> bool"
description = "Check if value is a singleton"
since = "0.1.0"
enabled = true

[[model.methods]]
name = "is_list"
signature = "is_list(&self) -> bool"
description = "Check if value is a list"
since = "0.1.0"
enabled = true

[[model.methods]]
name = "is_map"
signature = "is_map(&self) -> bool"
description = "Check if value is a map"
since = "0.1.0"
enabled = true

[[model.methods]]
name = "merge"
signature = "merge(self, other: Model) -> Model"
description = "Merge two models with composability rules"
since = "0.1.0"
enabled = true
example = '''
let m1 = Model::singleton("value1");
let m2 = Model::singleton("value2");
let merged = m1.merge(m2); // Creates list of both
'''

# ============================================================================
# Parser Features - Syntax Support
# ============================================================================

[[parser.features]]
name = "basic_key_value"
description = "Basic key=value pair parsing"
enabled = true
since = "0.1.0"
example = "name = Santa"

[[parser.features]]
name = "multiline_values"
description = "Values spanning multiple indented lines"
enabled = true
since = "0.1.0"
example = '''
description = This is a long
  description that spans
  multiple lines
'''

[[parser.features]]
name = "comments"
description = "Comment lines starting with /= or / (filtered from output)"
enabled = true
since = "0.1.0"
example = '''
/= This is a comment
name = Santa
'''

[[parser.features]]
name = "empty_key_lists"
description = "Lists defined with empty keys (= value)"
enabled = true
since = "0.1.0"
example = '''
items =
  = one
  = two
  = three
'''

[[parser.features]]
name = "nested_parsing"
description = "Automatic recursive parsing of values containing '='"
enabled = true
since = "0.1.0"
validation = "Validates keys don't start with '-' or contain spaces"
example = '''
database =
  host = localhost
  port = 5432
'''

[[parser.features]]
name = "section_headers"
description = "Section-style headers (== Section ==)"
enabled = false
since = "future"
status = "not_implemented"
note = "Many tests expect this but it's not implemented"

[[parser.features]]
name = "duplicate_key_handling"
description = "Multiple values for same key create a list"
enabled = false
since = "future"
status = "partially_implemented"
note = "Current behavior: last value wins, tests expect list creation"

# ============================================================================
# Value Interpretation Rules
# ============================================================================

[[interpretation.rules]]
name = "empty_value"
description = "Empty values become empty string singletons"
enabled = true
example = "key = "

[[interpretation.rules]]
name = "single_value"
description = "Single value without '=' becomes singleton string"
enabled = true
example = "name = Santa"

[[interpretation.rules]]
name = "nested_ccl_detection"
description = "Values with '=' parsed recursively if keys look valid"
enabled = true
validation = "Keys must not start with '-' or contain spaces"

[[interpretation.rules]]
name = "command_line_string_detection"
description = "Values with '=' treated as strings if keys look like flags"
enabled = true
example = "args = --flag=value --another"

[[interpretation.rules]]
name = "multiple_values_to_list"
description = "Multiple values for same key become list"
enabled = false
status = "not_implemented"
note = "Currently last value wins, should create list"

# ============================================================================
# Optional Features (Cargo Features)
# ============================================================================

[[cargo.features]]
name = "serde"
description = "Serde serialization/deserialization support"
enabled = true
default = false
dependencies = ["serde"]

[[cargo.features]]
name = "string-interning"
description = "String interning for memory efficiency"
enabled = false
status = "planned"
default = false

# ============================================================================
# Error Handling
# ============================================================================

[[errors]]
type = "ParseError"
description = "Failed to parse CCL syntax"
since = "0.1.0"

[[errors]]
type = "MissingKey"
description = "Requested key not found in map"
since = "0.1.0"

[[errors]]
type = "NotAMap"
description = "Attempted map operation on non-map value"
since = "0.1.0"

[[errors]]
type = "NotAList"
description = "Attempted list operation on non-list value"
since = "0.1.0"

[[errors]]
type = "NotASingleton"
description = "Attempted string operation on non-singleton value"
since = "0.1.0"

[[errors]]
type = "ValueError"
description = "Failed to parse value to requested type"
since = "0.1.0"

# ============================================================================
# Test Coverage
# ============================================================================

[test_coverage]
total_test_suites = 13
total_tests = 327
passing_tests = 110
failing_tests = 217
skip_reason = "Features not yet implemented (section headers, duplicate key lists)"

[[test_coverage.suites]]
name = "api_core_ccl_parsing"
tests = 8
passing = 8
failing = 0
status = "fully_implemented"

[[test_coverage.suites]]
name = "api_errors"
tests = 6
passing = 6
failing = 0
status = "fully_implemented"

[[test_coverage.suites]]
name = "api_edge_cases"
tests = 35
passing = 21
failing = 14
status = "partially_implemented"
notes = "Failures mostly related to section headers and duplicate key handling"

[[test_coverage.suites]]
name = "api_proposed_behavior"
tests = 60
passing = 14
failing = 46
status = "partially_implemented"
notes = "Many proposed features not yet implemented"

# ============================================================================
# Roadmap - Planned Features
# ============================================================================

[[roadmap]]
feature = "section_headers"
priority = "high"
description = "Support == Section == style headers"
affected_tests = 14
estimated_effort = "medium"

[[roadmap]]
feature = "duplicate_key_lists"
priority = "high"
description = "Multiple values for same key auto-create lists"
affected_tests = 6
estimated_effort = "medium"

[[roadmap]]
feature = "string_interning"
priority = "medium"
description = "Optional string interning for memory efficiency"
affected_tests = 0
estimated_effort = "low"

[[roadmap]]
feature = "typed_access_helpers"
priority = "low"
description = "Convenience methods for get_string, get_int, get_bool"
affected_tests = 49
estimated_effort = "low"

[[roadmap]]
feature = "advanced_list_operations"
priority = "low"
description = "List indexing, iteration, and manipulation"
affected_tests = 17
estimated_effort = "medium"
